(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self,t.printhub=e())})(this,function(){"use strict";class e{constructor(t,e=2e3){this.name="Bluetooth Low Energy",this.decoder=new TextDecoder("utf-8"),this.encoder=new TextEncoder,this.filters=t,this.timeout=e}async connect(){return new Promise((t,e)=>{setTimeout(()=>{e(`Timeout: Could not find a device with the name "${this.name}"`)},this.timeout),navigator.bluetooth.requestDevice({filters:this.filters,optionalServices:["00001800-0000-1000-8000-00805f9b34fb","0000180a-0000-1000-8000-00805f9b34fb","49535343-fe7d-4ae5-8fa9-9fafd205e455"]}).then(t).catch(e)})}async getCharacteristic(t,e,s){const i=await t.getPrimaryService(e);return await i.getCharacteristic(s)}async writeValue(t,e){const s=this.encoder.encode(e);await t.writeValue(s)}}class s{constructor(t=2e3){this.name="Classic Bluetooth",this.decoder=new TextDecoder("utf-8"),this.encoder=new TextEncoder,this.timeout=t}async connect(){return new Promise((t,e)=>{setTimeout(()=>{e(`Timeout: Could not find a device with the name "${this.name}"`)},this.timeout),navigator.bluetooth.requestDevice({acceptAllDevices:!0,optionalServices:["00001101-0000-1000-8000-00805f9b34fb"]}).then(t).catch(e)})}async getCharacteristic(t,e,s){const i=await t.getPrimaryService(e);return await i.getCharacteristic(s)}async writeValue(t,e){const s=this.encoder.encode(e);await t.writeValue(s)}}const i={esc:"\x1B",gs:"\x1D",lf:"\n"};class r{constructor(t){this.bluetooth=t}async init(){const t=await this.bluetooth.connect();return await t.gatt.connect()}async write(t){await this.bluetooth.writeValue(this.characteristic,t)}async create(t){const e=await this.init();this.characteristic=await this.bluetooth.getCharacteristic(e,"e7810a71-73ae-499d-8c15-faa9aef0c3f2","bef8d6c9-9c21-4c9e-b632-bd58c1009f9f"),this.write(t.join(""))}}class o{constructor(t){this.bluetooth=t,this.position={x:0,y:0}}async init(){const t=await this.bluetooth.connect();return await t.gatt.connect()}async write(t){await this.bluetooth.writeValue(this.characteristic,t)}async create(t){const e=await this.init();this.characteristic=await this.bluetooth.getCharacteristic(e,"49535343-fe7d-4ae5-8fa9-9fafd205e455","49535343-8841-43f4-a8d4-ecbe34729bb3");const s=t.join("");await this.write(s)}}var n;!function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right"}(n||(n={}));var a;!function(t){t.A="A",t.B="B"}(a||(a={}));var h;!function(t){t.SINGLE="single",t.DOUBLE="double"}(h||(h={}));const c={A:12,B:9},l={single:24,double:48},d={normal:24,large:32};class p{constructor(t,e){this.paperSize=t,this.printerType=e}async connect(t,e,s){let i;switch(this.printerType){case"ble":i=new r(new BluetoothDevice(t));break;case"bluetooth":i=new o(new BluetoothDevice(s));break;default:return}const n=new f({paperSize:this.paperSize,printer:i});await n.init(),e(n)}}const u=t=>`\x1B@${t}${i.esc}a${{left:String.fromCharCode(0),center:String.fromCharCode(1),right:String.fromCharCode(2)}[t.align||"left"]}${i.gs}!${{A:{single:"\x00",double:"\x11"},B:{single:"\x01",double:"\x10"}}[t.font||a.A][t.size||h.SINGLE]}${t.bold?`${i.esc}E${String.fromCharCode(1)}`:""}${t.text}${t.bold?`${i.esc}E${String.fromCharCode(0)}`:""}${i.lf}`,g=t=>`${i.esc}J${String.fromCharCode(t)}`,m=t=>`${i.esc}d${String.fromCharCode(t)}`,w=()=>" \n",f=class f{constructor(t){this.config=t.paperSize,this.printer=t.printer,this.paperWidth=d[this.config]}async init(){await this.printer.create([])}async writeText(t,e={}){const s=u({...e,text:t});await this.printer.write(s)}async writeLineBreak(t={}){if(!t.count||t.count<=0)return;const e=m(t.count);await this.printer.write(e)}async writeFeed(t={}){if(!t.count||t.count<=0)return;const e=g(t.count);await this.printer.write(e)}async writeDashLine(){const t="-".repeat(this.paperWidth);await this.writeText(t)}async writeEmptyLine(){const t=w();await this.printer.write(t)}async writeTextWith2Column(t,e){const s=this.paperWidth-e.length;if(t.length>s)throw new Error("First column text is too long");const i=s-t.length,r=" ".repeat(i),o=`${t}${r}${e}`;await this.writeText(o)}};class b{constructor(t){const{paperSize:e,printerType:s}=t;this.printerType=s,this.paperSize=e||"normal"}connectToPrint(t){const{onReady:e,onFailed:i}=t;try{this.connect(this.printerType).then(t=>{e(t)}).catch(t=>{i(t)})}catch(t){i(t)}}async connect(t){let e,r;if("ble"===t){const t=[{services:["e7810a71-73ae-499d-8c15-faa9aef0c3f2"]}];e=new o(new s(t))}else{if("bluetooth"!==t)throw new Error("Invalid printer type");e=new r(new s)}const n=new f({paperSize:this.paperSize,printer:e});return await n.init(),n}}return b});